sudo: required
services:
  - docker

language: java
jdk: oraclejdk8

branches:
  only:
    - master

before_install:
  - docker version
  - docker info
  - node --version
  - npm --version

script:
  - cd alma-server/src/main/resources
  - pwd
  - npm install -g gulp
  - npm install
  - gulp minify
  - cd ../../../../
  - mvn clean verify -f alma-server/pom.xml -e

after_success:
- docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASSWORD
- docker images
- docker push foorganization/alma-server:latest

deploy:
  provider: releases
  api_key: 
	secure : "Li6+dzn3Y/BHH6LHq+eOHLDTbLnWUY4GBUZ4RYcN+tkYCQxsDgpCNX77SOlGAgmlG+uQLt1vFodvTNrW7cpX4hiwZXoP/I4hD9agGGeO3Lkj2bURY7N/rL1D2rzoyKLMY2mlwQSdrS8CBX8aHUfdiR8k2HzdKZmSsd0wHnOAyDxIqN6Gh6T5TOqLHBnTFHjlf3xn48b08RxxwJHkQOR0II7XijFN1hJgVclJje4Sx86sDfMI+zBX/G7eOzZ9sxSkueeu8uAkZx8XBNiLjD3BJG52ycM2K54vyu8dsxA1X2SJqRvu2VvKM/VRZoPfbC1pQUcwf6e4peteWpKoBChE10qP3/lxUtj/via9jCe5zz8PmIfRS77nBb+czADToPbp87WjnNKQq/szTE8+J50fpqUwkGkWj9f4WnMR5zmJIR7NGqQbg4dTyOhbdU0UP+pxOpZ29DvzVWHNfWoAZuPWmRHjFPEdlUy8kbGfGlybCazzPSPntveimK/aK4xfjTGu7eNWkDFt2DNNzgqJq0ENxfrconplUeMW/Xk6fLyrfeNmni4hPez8m3kj3NixItiXt+AlfFytl+aQL6G8JdUO2e3WMA8gtTgXxXMoWkOvNb4sfLj5eHTdklTKtrr/AAxsLG5F7UnU50DqA3bbEB4WqR9rLRqDkuYg5QCLsNzEnCw="
  file: "alma-server-1.0.0-SNAPSHOT.jar"
  skip_cleanup: true
  on:
    tags: true
